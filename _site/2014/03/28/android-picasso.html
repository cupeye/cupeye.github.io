<!doctype html>
<!--[if lt ie 7]>      <html class="lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if ie 7]>         <html class="lt-ie9 lt-ie8 ie7"> <![endif]-->
<!--[if ie 8]>         <html class="lt-ie9 ie8"> <![endif]-->
<!--[if gt ie 8]><!-->
<html class=""><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Spoqa Tech Blog | Picasso 파헤치기</title>
  <link rel="canonical" href="https://spoqa.github.io/2014/03/28/android-picasso.html">
  <meta property="og:title" content="Picasso 파헤치기">
  <meta property="og:url" content="https://spoqa.github.io/2014/03/28/android-picasso.html">
  <meta property="og:site_name" content="컵아이">
  
  
  <meta property="og:type" content="article">
  <meta property="og:description" content="Android Image Loading Library 중 하나인 Picasso 에 대해 알아봅니다.">
  
  
  <script>
    window.WebFontConfig = {
        custom: {
            families: ['spoqahansans:100,400,700'],
            urls: ['/css/spoqahansans.css']
        },
        timeout: 60000
    };
    (function(d) {
        var wf = d.createElement('script'), s = d.scripts[0];
        wf.src = 'https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js';
        s.parentNode.insertBefore(wf, s);
    })(document);
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-36136046-5', 'auto');
    ga('send', 'pageview');
  </script>
  <link rel="stylesheet" href="../../../css/styles.css">
  <link href="../../../atom.xml" type="application/atom+xml" rel="alternate" title="Spoqa 기술 블로그">
  <link rel="shortcut icon" href="../../../images/favicon.ico">
  <style type="text/css">
@media only screen and (max-width: 580px) {
  .btn-job {
    display: none;
  }
}
</style>
</head>
<body>
  <div class="wrapper">
    <div class="header">
      <div class="header-item">
        <div class="spoqa-logo-wrap">
          <a class="spoqa-logo" href="../../../"><img style="margin-top:-20px" src="../../../images/logo.png" alt="Spoqa logo"></a>
          <a class="blog-title" href="../../../">컵아이</a>
        </div>
        <div class="nav">
          <input type="checkbox" id="toggle">
          <label for="toggle" class="toggle" onclick></label>
          <ul class="menu">
            <li><a class="selected menu-about" href="../../../about.html">소개</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="content">
      


<div class="post-author-info">
  
    <img class="portrait" src="../../../images/profile/hyunwoo@spoqa.com.png" />
    <h1 class="post-title">Picasso 파헤치기</h1>
    <span class="post-date">2014년 03월 28일</span>
    <span class="sep">|</span>
    <span class="author-name"><a href="mailto:hyunwoo@spoqa.com">정현우</a></span>
  
</div>



  <div class="post"><p>안녕하세요. 스포카 개발팀의 정현우입니다. 저희 안드로이드 모바일앱이 세 번째 버전으로 업데이트되면서 외적(사용자 측면)으로나 내적(구현 측면)으로 많은 변화가 있었는데요. 내적인 변화 중 하나는 검증된 오픈소스 라이브러리들을 많이 사용했다는 점입니다. 그중에 하나인 <a href="http://square.github.io/picasso/">Picasso</a>에 관해 얘기해 보려고 합니다.</p>

<h2 id="what-is-picasso">What is Picasso?</h2>

<p>안드로이드에서 여러 이미지가 화면에 나열 되는 UI는 자주 쓰이고 있습니다. 많은 개발자가 이것을 편리하게 하려고 라이브러리를 제작하여 공개했습니다. Picasso는 그 중에 하나로써 <a href="http://square.github.io/">Square</a> 사의 <a href="https://github.com/JakeWharton">Jake Wharton</a>이 개발한 라이브러리입니다.</p>

<h2 id="why-picasso">Why Picasso?</h2>

<p>직접 수많은 라이브러리를 비교해보지는 못했고 대신 Hello World 블로그의 <a href="http://helloworld.naver.com/helloworld/429368">Android의 이미지 로딩 라이브러리</a>를 참고했습니다. Picasso를 선택한 이유는 다음과 같습니다.</p>

<ol>
  <li>모듈화가 잘 되어있어서 확장에 용이하다</li>
  <li>API가 간결하다</li>
  <li><del>Jake Wharton이 개발했다</del></li>
</ol>

<h2 id="dive-into-picasso">Dive into Picasso</h2>

<p>Picasso가 작동하는 방식과 중요한 클래스들을 살펴보도록 하겠습니다. (소스는 <a href="https://github.com/square/picasso/commit/f78c6b989d365b4bbe32f05bfd618f731aac30f9">v2.2.0</a>을 기준으로 합니다.)</p>

<p><img src="/images/2014-03-28/1.png" alt="workflow" /></p>

<h3 id="section">1. 이미지 불러오기 요청</h3>

<p>이미지를 불러오기 위해 <a href="#picasso"><code>Picasso</code></a>를 사용합니다. 간단한 용례는 다음과 같습니다.</p>

<pre><code>Picasso.with(context)
       .load(placeImageUrl)
       .error(R.drawable.error)
       .placeholder(R.drawable.placeholder)
       .transform(myTransformer)
       .into(placeImageView);
</code></pre>

<h3 id="section-1">2. 캐시 검사</h3>

<p><a href="#picasso">Picasso</a>는 <a href="#cache"><code>Cache</code></a> 인터페이스를 통해 캐시를 저장하고 가져옵니다. 만약 캐시에 요청한 이미지가 존재하면 캐시를 사용합니다.</p>

<h3 id="section-2">3–4. 백그라운드로 스레드에서 이미지 불러오기</h3>

<p><a href="#cache"><code>Cache</code></a>에 캐시된 이미지가 없다면 <a href="#dispatcher"><code>Dispatcher</code></a>를 통해 백그라운드 스레드에서 <a href="#bitmaphunter"><code>BitmapHunter</code></a>가 이미지를 불러올 수 있도록 합니다.</p>

<h3 id="section-3">5. 캐시 검사 및 이미지 불러오기</h3>

<p>다시 한 번 캐시를 검사합니다. 이때 캐시된 이미지가 있으면 그걸 사용합니다. 없다면 <a href="#bitmaphunter"><code>BitmapHunter</code></a> 인터페이스는 실제 구현에 따라 이미지 불러오게 됩니다. <a href="#bitmaphunter"><code>BitmapHunter</code></a>의 구현체가 NetworkBitmapHunter인 경우 <a href="#downloader"><code>Downloader</code></a> 인터페이스를 통해 이미지를 내려받습니다.</p>

<h3 id="section-4">6. 이미지 후처리</h3>

<p><a href="#bitmaphunter"><code>BitmapHunter</code></a>가 이미지를 불러오면 <a href="#transformer"><code>Transformer</code></a> 인터페이스를 통해 이미지 후처리를 할 수 있도록 합니다.</p>

<h3 id="section-5">7–8. 불러온 이미지 적용</h3>

<p>이미지 불러오기를 마친 <a href="#bitmaphunter"><code>BitmapHunter</code></a>는 다시 <a href="#dispatcher"><code>Dispatcher</code></a>를 통해 UI 스레드로 비트맵을 전달합니다. <a href="#dispatcher"><code>Dispatcher</code></a>는 비트맵을 <a href="#action"><code>Action</code></a> 인터페이스로 구현된 방식으로 이미지를 처리합니다.</p>

<p>이렇게 Picasso는 단계별로 인터페이스를 두고 확장 가능하도록 구현되어 있습니다. 필요에 따라 캐시 방식을 바꾸고 싶다면 <a href="#cache"><code>Cache</code></a> 인터페이스를 구현하고 이미지 후처리 방식을 바꾸고 싶다면 <a href="#transformer"><code>Transformer</code></a> 인터페이스를 구현하면 됩니다. 별도로 구현하지 않으면 이미 정의된 구현체들이 각 단계별로 사용됩니다.</p>

<h2 id="appendix">Appendix</h2>

<h3 id="picasso">com.squareup.picasso.Picasso(<a href="http://square.github.io/picasso/javadoc/index.html">javadoc</a>)</h3>

<p>Picasso로 이미지를 불러올 때 사용하게되는 빌더입니다. <code>RequestCreator</code>와 함께 <a href="http://en.wikipedia.org/wiki/Method_chaining">Method Chaining</a> 혹은 <a href="http://en.wikipedia.org/wiki/Builder_pattern">Builder Pattern</a>로 불리는 방법으로 API를 간결하게 사용 할 수 있도록 합니다.</p>

<h3 id="dispatcher">com.squareup.picasso.Dispatcher</h3>

<p>백그라운드 스레드와 UI 스레드 간에 통신하게되는 통로입니다. <a href="#picasso"><code>Picasso</code></a>에서 요청 데이터를 전달 받아 Background 에서 <a href="#bitmaphunter"><code>BitmapHunter</code></a>가 비트맵을 불러올 수 있도록 합니다. 비트맵을 UI 스레드에 전달해서 처리할 수 있도록 합니다.</p>

<h3 id="cache">com.squareup.picasso.Cache(<a href="http://square.github.io/picasso/javadoc/com/squareup/picasso/Picasso.html">javadoc</a>)</h3>

<p>이미지 캐싱을 위한 모듈입니다. 기본 구현체로는 <a href="http://en.wikipedia.org/wiki/Least_Recently_Used#LRU">LRU</a> 방식으로 캐시하는 <code>LruCache</code>가 사용됩니다.</p>

<h3 id="bitmaphunter">com.squareup.picasso.BitmapHunter</h3>

<p>비트맵을 불러오는 모듈입니다. 자주 사용되는 구현체로는 <code>ResourceBitmapHunter</code>와 <code>NetworkBitmapHunter</code>가 있습니다.</p>

<p><code>Picasso.load()</code>메소드에 리소스 아이디를 넘겨주면 <code>ResourceBitmapHunter</code>가 사용되고 <a href="http://developer.android.com/reference/android/net/Uri.html">Uri</a>를 넘겨주면 <a href="http://en.wikipedia.org/wiki/URI_scheme">URI Scheme</a>에 따라서 <code>NetworkBitmapHunter</code>, <code>ContentProviderBitmapHunter</code>, <code>AssetBitmapHunber</code> 등이 사용됩니다. (자세한 내용은 <code>BitmapHunter.forRequest</code>메소드에 구현되어 있습니다.)</p>

<h3 id="downloader">com.squareup.picasso.Downloader(<a href="http://square.github.io/picasso/javadoc/com/squareup/picasso/Downloader.html">javadoc</a>)</h3>

<p><code>NetworkBitmapHunter</code>가 이미지를 내려받을 때 사용하는 인터페이스입니다. 기본 구현체는 <a href="http://square.github.io/okhttp/">OkHttp</a>를 사용할 수 있는지 여부에 따라 다릅니다.</p>

<ol>
  <li>만약 <a href="http://square.github.io/okhttp/">OkHttp</a>를 사용할 수 있다면 Http Client 를 <a href="http://square.github.io/okhttp/">OkHttp</a>로 사용하는 <code>OkHttpDownloader</code>가 기본 구현체가 됩니다.</li>
  <li>그렇지 않은 경우에는 Http Client 를 <code>HttpURLConnection</code>로 사용하는 <code>UrlConnectionDownloader</code>가 기본 구현체가 됩니다.</li>
</ol>

<h3 id="transformer">com.squareup.picasso.Transformer</h3>

<p><a href="#bitmaphunter"><code>BitmapHunter</code></a>가 비트맵을 만들면 후처리를 하는 모듈입니다. 불러온 이미지를 마스킹 한다던지 블러 효과를 주고싶다면 <a href="#transformer"><code>Transformer</code></a>인터페이스를 구현하면 됩니다.</p>

<h3 id="action">com.squareup.picasso.Action</h3>

<p><a href="#bitmaphunter"><code>BitmapHunter</code></a>를 통해 불러오고 <a href="#transformer"><code>Transformer</code></a>를 통해 후처리가 끝난 비트맵은 <a href="#action"><code>Action</code></a>이 가져가서 처리를 하게됩니다. 불러온 비트맵을 어떻게 할지 결정하는 모듈이라고 볼 수 있습니다. 일반적으로 쓰게되는 <a href="#action"><code>Action</code></a>의 구현체는 <code>ImageViewAction</code> 인데, 생성된 키트맵을 <code>ImageView</code> 에 설정합니다.</p>

</div>


<div class="post-footer">
  <div class="back-btn"><a href="/">목록으로 돌아가기</a></div>
  <div class="fb-like" data-href="https://spoqa.github.io/2014/03/28/android-picasso.html" data-layout="button_count" data-width="" data-share="false" data-show-faces="false"></div>
  <div class="fb-comments" data-href="https://spoqa.github.io/2014/03/28/android-picasso.html" data-num-posts="5" data-width=""></div>
  <div id="fb-root"></div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function(event) {
    $('.fb-like, .fb-comments').attr('data-width', "100%");
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/ko_KR/all.js#xfbml=1&appId=207542736008055";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
});
</script>
<style>
.hiring-banner {
  height: 320px;
  background-position-y: 80%;
}
.hiring-subtitle
{
  display: none;
}
.btn-job{
  margin-top: 4px;
}
@media only screen and (max-width: 360px) {
  .hiring-banner {
    height: 220px;
  }
}
}
</style>

    </div>
    <div class="push">
    </div>
    <div class="footer">
      <div id="info">
        <span>© <a href="http://cupeye.com/">컵아이</a> Inc. All rights reserved.</span>
        <span>Powered by <a href="https://pages.github.com/">GitHub Pages</a>.</span>
      </div>
    </div>
  </div>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="../../../js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
    $(function() {
      $('.hiring-banner').bind("click", function() {
        location.href = '/jobs.html';
      });
      $('.toggle').bind("touchstart", function() {
        $('.menu').toggle();
      })
    });
  </script>
  <!-- Responsive layout polyfill for IE8 and lower -->
  <!--[if lte IE 8]>
  <script>
    var config = {
        mobileResponsiveBreakpoint: 650
    };
    $(window).on('resize', function(){
        if ($(window).width() <= config.mobileResponsiveBreakpoint) {
           !$(document.body).hasClass('res-mobile')) {
            $(document.body).addClass('res-mobile');
        } else {
            $(document.body).removeClass('res-mobile');
        }
    }).trigger('resize');
  </script>
  <![endif]-->
</body>
</html>
