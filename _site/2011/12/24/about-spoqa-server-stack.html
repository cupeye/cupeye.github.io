<!doctype html>
<!--[if lt ie 7]>      <html class="lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if ie 7]>         <html class="lt-ie9 lt-ie8 ie7"> <![endif]-->
<!--[if ie 8]>         <html class="lt-ie9 ie8"> <![endif]-->
<!--[if gt ie 8]><!-->
<html class=""><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Spoqa Tech Blog | 스포카 서버의 구조</title>
  <link rel="canonical" href="https://spoqa.github.io/2011/12/24/about-spoqa-server-stack.html">
  <meta property="og:title" content="스포카 서버의 구조">
  <meta property="og:url" content="https://spoqa.github.io/2011/12/24/about-spoqa-server-stack.html">
  <meta property="og:site_name" content="컵아이">
  
  
  <meta property="og:type" content="article">
  <meta property="og:description" content="스포카 서버의 구조와 사용된 기술들에 대해서 알아봅니다.">
  
  
  <script>
    window.WebFontConfig = {
        custom: {
            families: ['spoqahansans:100,400,700'],
            urls: ['/css/spoqahansans.css']
        },
        timeout: 60000
    };
    (function(d) {
        var wf = d.createElement('script'), s = d.scripts[0];
        wf.src = 'https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js';
        s.parentNode.insertBefore(wf, s);
    })(document);
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-36136046-5', 'auto');
    ga('send', 'pageview');
  </script>
  <link rel="stylesheet" href="../../../css/styles.css">
  <link href="../../../atom.xml" type="application/atom+xml" rel="alternate" title="Spoqa 기술 블로그">
  <link rel="shortcut icon" href="../../../images/favicon.ico">
  <style type="text/css">
@media only screen and (max-width: 580px) {
  .btn-job {
    display: none;
  }
}
</style>
</head>
<body>
  <div class="wrapper">
    <div class="header">
      <div class="header-item">
        <div class="spoqa-logo-wrap">
          <a class="spoqa-logo" href="../../../"><img style="margin-top:-20px" src="../../../images/logo.png" alt="Spoqa logo"></a>
          <a class="blog-title" href="../../../">컵아이</a>
        </div>
        <div class="nav">
          <input type="checkbox" id="toggle">
          <label for="toggle" class="toggle" onclick></label>
          <ul class="menu">
            <li><a class="selected menu-about" href="../../../about.html">소개</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="content">
      


<div class="post-author-info">
  
    <img class="portrait" src="../../../images/profile/longfin@spoqa.com.png" />
    <h1 class="post-title">스포카 서버의 구조</h1>
    <span class="post-date">2011년 12월 24일</span>
    <span class="sep">|</span>
    <span class="author-name"><a href="mailto:longfin@spoqa.com">문성원</a></span>
  
</div>



  <div class="post"><p>안녕하세요. <a href="https://spoqa.github.io/">스포카 개발팀</a>에서 서버 관련 개발 업무를 담당하고 있는 문성원입니다. 오늘은 스포카 서버의 구조와 사용된 기술들에 대해서 함께 살펴보겠습니다.</p>

<h1 id="section">스택이란?</h1>
<hr />
<p>먼저 스택(Stack)이란 용어에 대해서 함께 생각해보죠. 컴퓨터 과학을 공부하신 분들이라면 선입후출(FILO)이나 스택 오버플로우(Stack Overflow)등의 개념으로 익숙하실만한 용어기도 합니다. 그런데 서버 구조를 설명한다면서 왠 스택이냐구요? 다행히(?)도 지금부터 살펴 볼 스택은 <a href="http://en.wikipedia.org/wiki/Solution_stack">솔루션 스택(Solution Stack)</a>입니다. 스포카 서버라는 큰 솔루션이 원활히 동작하기 위해서 쓰이고 있는 각종 서브 시스템과 컴포넌트들의 묶음을 이야기하는 것으로 바꿔말하자면 이 글에서 다룰 기술 이야기는 모두 이 스택에 관한 이야기입니다.</p>

<p>2011년 12월 현재 스포카 서버를 구성하고 있는 스택은 다음과 같습니다.</p>

<ul>
  <li><a href="http://dotcloud.com/">Dotcloud</a>
    <ul>
      <li><a href="https://github.com/torvalds/linux">Linux</a> 2.6.38.2</li>
      <li><a href="http://nginx.org/">nginx</a> 0.8.53</li>
      <li><a href="http://projects.unbit.it/uwsgi">uwsgi</a> 0.9.8.5</li>
      <li><a href="http://python.org/">Python</a> 2.6.5</li>
      <li><a href="http://redis.io/">Redis</a> 2.2.2</li>
      <li><a href="http://celeryproject.org/">Celery</a> 2.2.7</li>
    </ul>
  </li>
  <li><a href="http://aws.amazon.com/rds/">Amazon Relational Database Service</a>
    <ul>
      <li><a href="http://www.mysql.com/">MySQL</a> 5.5.12</li>
    </ul>
  </li>
  <li><a href="http://aws.amazon.com/s3/">Amazon Simple Storage Service</a></li>
</ul>

<h1 id="dotcloud"><a href="http://dotcloud.com/">Dotcloud</a></h1>
<hr />
<p><a href="http://dotcloud.com/">Dotcloud</a>는 지금부터 설명드릴 스택을 묶어서 제공해주는 <a href="http://en.wikipedia.org/wiki/Platform_as_a_service">PaaS(Platform as a Service)</a>의 일종입니다. <a href="http://aws.amazon.com/ec2/">Amazon Elastic Cloud Computing(Amazon EC2)</a> 기반으로 동작하며 거기에 더해 <strong>손쉬운 확장과 배포</strong>가 장점입니다. 스포카 서버는 데이터베이스(<a href="http://aws.amazon.com/rds/">Amazon RDS</a>)와 업로드되는 데이터(<a href="http://aws.amazon.com/s3/">Amazon S3</a>) 이외의 모든 서비스를 <a href="http://dotcloud.com/">Dotcloud</a>를 통하여 제공하고 있습니다.</p>

<h1 id="nginx-uwsgi--wsgi"><a href="http://nginx.org/">nginx</a>, <a href="http://projects.unbit.it/uwsgi">uwsgi</a>. 그리고 <a href="http://www.wsgi.org/en/latest/index.html">WSGI</a></h1>
<hr />
<p>기본적으로 스포카 서버는 <a href="http://www.w3.org/Protocol">HTTP</a> 형식의 요청을 받아 응답을 돌려주는 웹 어플리케이션입니다. 이러한 처리는 1차적으로 <a href="http://nginx.org/">nginx</a>를 통해 이뤄지는데, 이 중 서버사이드에서 처리가 필요한 경우에는 <a href="http://projects.unbit.it/uwsgi">uwsgi</a>라는 데몬이 이 처리를 담당합니다. (구버젼의 <a href="http://tomcat.apache.org/">Apache Tomcat</a>을 사용하시던 <a href="http://www.java.com/">Java</a> 개발자분들은 <a href="http://tomcat.apache.org/">Apache Tomcat</a>과 <a href="http://httpd.apache.org/">Apache httpd</a>와의 관계를 떠올리시면 편합니다.)</p>

<p>이 경우 <a href="http://projects.unbit.it/uwsgi">uwsgi</a>는 일종의 <strong>어플리케이션 컨테이너(Application Container)</strong>로 동작하게 됩니다. 적재한 어플리케이션을 실행만 시켜주는 역할이죠. 이러한 <a href="http://projects.unbit.it/uwsgi">uwsgi</a>에 적재할 어플리케이션(스포카 서버)에는 일종의 규격이 존재하는데, 이걸 <a href="http://www.wsgi.org/en/latest/index.html">WSGI</a>라고 합니다.(정확히는 <a href="http://www.wsgi.org/en/latest/index.html">WSGI</a>에 의해 정의된 어플리케이션을 돌릴 수 있게 설계된 컨테이너가 <a href="http://projects.unbit.it/uwsgi">uwsgi</a>라고 봐야겠지만요.) <a href="http://www.wsgi.org/en/latest/index.html">WSGI</a>는 <a href="http://python.org/">Python</a> 표준(<a href="http://www.python.org/dev/peps/pep-0333/">PEP-033</a>)으로 <a href="http://www.w3.org/Protocol">HTTP</a>를 통해 요청을 받아 응답하는 어플리케이션에 대한 명세로 이러한 명세를 만족시키는 클래스나 함수, (<a href="http://docs.python.org/reference/datamodel.html#object.__call__">__call__</a>을 통해 부를 수 있는)객체를 <strong>WSGI 어플리케이션</strong>이라고 합니다.</p>

<p>정리하자면 스포카 서버는 <a href="http://www.wsgi.org/en/latest/index.html">WSGI</a>에 맞게 작성된 프로그램을 <a href="http://nginx.org/">nginx</a>와 <a href="http://projects.unbit.it/uwsgi">uwsgi</a>를 통해 운용하여 요청을 처리하는 웹 어플리케이션이라고 할 수 있습니다.</p>

<h1 id="redis"><a href="http://redis.io/">Redis</a></h1>
<hr />
<p><a href="http://redis.io/">Redis</a>란 <strong>키-값(Key-Value) 저장 서버</strong>로 확장이 용이하며 속도가 우수합니다. 스포카 서버에선 이를 <strong>내부적인 임시 데이터 관리</strong>와 <a href="http://celeryproject.org/">Celery</a>의 <strong>작업(Task) 분배</strong>에 사용하고 있습니다.</p>

<h1 id="celery"><a href="http://celeryproject.org/">Celery</a></h1>
<hr />
<p><a href="http://celeryproject.org/">Celery</a>는 <a href="http://python.org/">Python</a>으로 작성된 <strong>비동기 작업 큐(Asynchronous task queue/job queue)</strong>입니다. 앞서 소개한 <strong>작업(Task)</strong>를 <strong>브로커(Broker, 스포카 서버는 <a href="http://redis.io/">Redis</a>를 사용)</strong>를 통해 전달하면 하나 이상의 <strong>워커(Worker)</strong>가 이를 처리하는 구조입니다. 포인트 적립-공유에 따른 분배처리, 포스팅 기능, 페이스북/트위터 공유등의 비동기 처리가 필요한 작업을 <a href="http://celeryproject.org/">Celery</a>에 위임하여 처리하고 있습니다.</p>

<h1 id="amazon-relational-database-serviceamazon-rds"><a href="http://aws.amazon.com/rds/">Amazon Relational Database Service</a></h1>
<hr />
<p>대부분의 웹 어플리케이션과 마찬가지로 스포카 서버는 영속적으로 저장되어야하는 정보(회원 목록, 구매 내역)들을 디스크 기반의 데이터베이스(Database)에 저장합니다. <a href="http://aws.amazon.com/rds/">Amazon Relational Database Service(Amazon RDS)</a>는 <a href="http://aws.amazon.com/ec2/">Amazon EC2</a>를 기반으로 그러한 데이터베이스를 간편하게 관리(모니터링, 백업, 접근제어)할 수 있게 도와주는 웹서비스입니다. <a href="http://www.oracle.com/kr/products/database/index.html">Oracle</a>과 <a href="http://www.mysql.com/">MySQL</a>을 지원하는데 스포카 서버는 그 중 <a href="http://www.mysql.com/">MySQL</a>을 사용하고 있습니다.</p>

<h1 id="amazon-simple-storage-serviceamazon-s3"><a href="http://aws.amazon.com/s3/">Amazon Simple Storage Service</a></h1>
<hr />
<p><a href="http://aws.amazon.com/s3/">Amazon Simple Storage Service(Amazon S3)</a>는 <a href="http://aws.amazon.com/rds/">Amazon RDS</a>와 마찬가지로 <a href="http://aws.amazon.com/ec2/">Amazon EC2</a>를 기반으로 한 데이터 저장 관리 서비스입니다. 스포카 서버에 업로드 되는 사진이나 문서등의 파일들을 통합하여 관리하여 서버의 인스턴스를 늘려 확장하는 경우에도 문제없이 대처할 수 있도록 하는 것이 주 목적입니다.</p>

</div>


<div class="post-footer">
  <div class="back-btn"><a href="/">목록으로 돌아가기</a></div>
  <div class="fb-like" data-href="https://spoqa.github.io/2011/12/24/about-spoqa-server-stack.html" data-layout="button_count" data-width="" data-share="false" data-show-faces="false"></div>
  <div class="fb-comments" data-href="https://spoqa.github.io/2011/12/24/about-spoqa-server-stack.html" data-num-posts="5" data-width=""></div>
  <div id="fb-root"></div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function(event) {
    $('.fb-like, .fb-comments').attr('data-width', "100%");
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/ko_KR/all.js#xfbml=1&appId=207542736008055";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
});
</script>
<style>
.hiring-banner {
  height: 320px;
  background-position-y: 80%;
}
.hiring-subtitle
{
  display: none;
}
.btn-job{
  margin-top: 4px;
}
@media only screen and (max-width: 360px) {
  .hiring-banner {
    height: 220px;
  }
}
}
</style>

    </div>
    <div class="push">
    </div>
    <div class="footer">
      <div id="info">
        <span>© <a href="http://cupeye.com/">컵아이</a> Inc. All rights reserved.</span>
        <span>Powered by <a href="https://pages.github.com/">GitHub Pages</a>.</span>
      </div>
    </div>
  </div>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="../../../js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
    $(function() {
      $('.hiring-banner').bind("click", function() {
        location.href = '/jobs.html';
      });
      $('.toggle').bind("touchstart", function() {
        $('.menu').toggle();
      })
    });
  </script>
  <!-- Responsive layout polyfill for IE8 and lower -->
  <!--[if lte IE 8]>
  <script>
    var config = {
        mobileResponsiveBreakpoint: 650
    };
    $(window).on('resize', function(){
        if ($(window).width() <= config.mobileResponsiveBreakpoint) {
           !$(document.body).hasClass('res-mobile')) {
            $(document.body).addClass('res-mobile');
        } else {
            $(document.body).removeClass('res-mobile');
        }
    }).trigger('resize');
  </script>
  <![endif]-->
</body>
</html>
